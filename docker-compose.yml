services:
  openclaw:
    image: ghcr.io/waterlou/openclaw:latest
    container_name: openclaw-nas
    restart: unless-stopped

    # Port for OpenClaw gateway
    ports:
      - "18789:18789"

    # Environment variables
    environment:
      # AI Provider (choose one and set your API key)
      # ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      # OPENAI_API_KEY: ${OPENAI_API_KEY}
      # GEMINI_API_KEY: ${GEMINI_API_KEY}

      # Gateway configuration
      OPENCLAW_GATEWAY_BIND: lan
      # OPENCLAW_GATEWAY_TOKEN: your-secret-token-here

      # Browser configuration (Chromium is pre-installed)
      PLAYWRIGHT_BROWSERS_PATH: /home/node/.cache/ms-playwright

    # Persist state and workspace
    volumes:
      - openclaw-data:/home/node/.openclaw
      - openclaw-workspace:/home/node/workspace
      - openclaw-browser-cache:/home/node/.cache/ms-playwright

    # Resource limits (adjust based on your NAS specs)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '0.5'
          memory: 512M

    # Health check
    healthcheck:
      test: ["CMD", "node", "dist/index.js", "health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  openclaw-data:
    name: openclaw-data
  openclaw-workspace:
    name: openclaw-workspace
  openclaw-browser-cache:
    name: openclaw-browser-cache

# Optional: Add a browser sidecar if you need a full desktop UI
# services:
#   browser:
#     image: kasmweb/chrome:latest
#     container_name: openclaw-browser
#     restart: unless-stopped
#     ports:
#       - "6901:6901"  # noVNC web UI
#       - "9222:9222"  # Chrome DevTools Protocol (CDP)
#     shm_size: 512m
#     environment:
#       VNC_PW: change-this-password
#     networks:
#       - openclaw-network
#
#   openclaw:
#     image: ghcr.io/waterlou/openclaw:latest
#     ...
#     environment:
#       BROWSER_CDP_URL: http://browser:9222
#     networks:
#       - openclaw-network
#
# networks:
#   openclaw-network:
#     driver: bridge
